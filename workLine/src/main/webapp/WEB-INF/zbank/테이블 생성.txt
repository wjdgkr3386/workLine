#데이터베이스 생성
CREATE DATABASE work_line DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

#데이터베이스 선택
use work_line;

create table member(
	id				int				auto_increment primary key,
	mid				varchar(50)		unique,
    pwd				varchar(200)	not null,
    username		varchar(20)		not null,
    phone			varchar(12)		not null,
    email			varchar(50)		not null,
    nickname		varchar(20)		null,
    img				varchar(50)		default '/static/img/user_profile.png',
    is_deleted		char(1)			default 'n',
    created_date	timestamp		default now()
);

create table friend(
	my_id			int			not null,
	friend_id		int			not null,
	status			int			default 0 not null,  -- 0=요청, 1=수락, 2=거절, 3=차단
	create_date		timestamp	default now(),
	primary key(my_id, friend_id),
    foreign key(my_id) references member(id),
    foreign key(friend_id) references member(id)
);

create table chatroom(
	room_id			int				auto_increment	primary key,
    room_type		int				not null,
    room_name		varchar(100)	null,
    create_date		timestamp		default	now()
);

create table chatroom_member(
	room_id			int			not null,
    member_id		int			not null,
    primary key(room_id,member_id),
    foreign key(room_id) references chatroom(room_id),
    foreign key(member_id) references member(id)
);

create table message(
	message_id		bigint			auto_increment primary key,
	room_id			int				null,
    member_id		int				null,
    content			text			not null,
    create_date		timestamp		default now(),
    foreign key(room_id) references chatroom(room_id),
    foreign key(member_id) references member(id)
);